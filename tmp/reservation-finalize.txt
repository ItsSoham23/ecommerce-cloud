**********************
Windows PowerShell transcript start
Start time: 20251123150700
Username: ROMIT\jainr
RunAs User: ROMIT\jainr
Configuration Name: 
Machine: ROMIT (Microsoft Windows NT 10.0.26100.0)
Host Application: C:\WINDOWS\System32\WindowsPowerShell\v1.0\powershell.exe -noexit -command try { . "c:\Users\jainr\AppData\Local\Programs\Microsoft VS Code\resources\app\out\vs\workbench\contrib\terminal\common\scripts\shellIntegration.ps1" } catch {}
Process ID: 20776
PSVersion: 5.1.26100.7019
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.26100.7019
BuildVersion: 10.0.26100.7019
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
Transcript started, output file is C:\Users\jainr\repos\ecommerce-cloud\tmp\reservation-finalize.txt
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>$prodId=6
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Write-Output "Simulating payment FAIL for current reservation by incrementing stock +1 (release)":
Simulating payment FAIL for current reservation by incrementing stock +1 (release)
:
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>try { $r = Invoke-RestMethod -Uri "http://localhost:8082/api/products/$prodId/stock" -Method Patch -ContentType 'application/json' -Body (@{ quantity = 1 } | ConvertTo-Json) -ErrorAction Stop; $r | ConvertTo-Json -Depth 6 } catch { Write-Output "Patch stock failed: $($_.Exception.Message)"; Stop-Transcript; exit 1 }
{
    "id":  6,
    "name":  "Limited Edition Widget",
    "description":  "One-of-a-kind widget",
    "price":  "49.99",
    "category":  "Gadgets",
    "stock":  1,
    "imageUrl":  null,
    "s3Key":  null,
    "isActive":  true,
    "reservedByOrderId":  null,
    "reservedUntil":  null,
    "createdAt":  "2025-11-22T22:10:19.380Z",
    "updatedAt":  "2025-11-23T09:37:00.782Z"
}
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Start-Sleep -Seconds 1
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Write-Output "GET product after release:";
GET product after release:
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>try { $p = Invoke-RestMethod -Uri "http://localhost:8082/api/products/$prodId" -Method Get -ErrorAction Stop; $p | ConvertTo-Json -Depth 6 } catch { Write-Output "GET failed: $($_.Exception.Message)"; Stop-Transcript; exit 1 }
{
    "id":  6,
    "name":  "Limited Edition Widget",
    "description":  "One-of-a-kind widget",
    "price":  "49.99",
    "category":  "Gadgets",
    "stock":  1,
    "imageUrl":  null,
    "s3Key":  null,
    "isActive":  true,
    "reservedByOrderId":  null,
    "reservedUntil":  null,
    "createdAt":  "2025-11-22T22:10:19.380Z",
    "updatedAt":  "2025-11-23T09:37:00.782Z"
}
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Write-Output "Now retrying order for user-B (should succeed because reservation was released)";
Now retrying order for user-B (should succeed because reservation was released)
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>$bodyB = @{ userId = 'user-B'; items = @(@{ productId = "$prodId"; quantity = 1 }) } | ConvertTo-Json -Depth 6
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>try { $retry = Invoke-RestMethod -Uri 'http://localhost:8084/api/orders' -Method Post -ContentType 'application/json' -Body $bodyB -ErrorAction Stop; $retry | ConvertTo-Json -Depth 6 } catch { Write-Output "Retry failed: $($_.Exception.Message)" }
{
    "orderId":  "ord-1763890622236",
    "userId":  "user-B",
    "items":  [
                  {
                      "productId":  "6",
                      "quantity":  1,
                      "price":  49.99,
                      "productName":  "Limited Edition Widget"
                  }
              ],
    "total":  49.99,
    "status":  "AWAITING_PAYMENT",
    "paymentId":  null,
    "createdAt":  "2025-11-23T09:37:02.320Z"
}
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Start-Sleep -Seconds 1
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Write-Output "GET product after retry:";
GET product after retry:
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>try { $pf = Invoke-RestMethod -Uri "http://localhost:8082/api/products/$prodId" -Method Get -ErrorAction Stop; $pf | ConvertTo-Json -Depth 6 } catch { Write-Output "GET failed: $($_.Exception.Message)" }
{
    "id":  6,
    "name":  "Limited Edition Widget",
    "description":  "One-of-a-kind widget",
    "price":  "49.99",
    "category":  "Gadgets",
    "stock":  0,
    "imageUrl":  null,
    "s3Key":  null,
    "isActive":  true,
    "reservedByOrderId":  "ord-1763890622236",
    "reservedUntil":  "2025-11-23T09:47:02.286Z",
    "createdAt":  "2025-11-22T22:10:19.380Z",
    "updatedAt":  "2025-11-23T09:37:02.286Z",
    "_reserved":  true
}
]633;D;0]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
]633;D]633;A]633;P;Cwd=C:\x5cUsers\x5cjainr\x5crepos\x5cecommerce-cloudPS C:\Users\jainr\repos\ecommerce-cloud> ]633;B
PS>Stop-Transcript
**********************
Windows PowerShell transcript end
End time: 20251123150703
**********************
